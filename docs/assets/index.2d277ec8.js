import{J as Oe,E as Pe,w as q,z as Ne,K as Ue,b as w,f as x,e as ye,d as it,_ as at,q as Ae,o as he,h as pe,C as st,j as R,i as $,L as ve,M as Ce,t as ne,n as ut,m as ct,B as Re,F as lt,s as dt,x as gt}from"./index.5eac687e.js";var F=(e=>(e.Mouseover="mouseover",e.Mouseenter="mouseenter",e.Mouseout="mouseout",e.Mouseleave="mouseleave",e.Mouseup="mouseup",e.Mousemove="mousemove",e.MouseDown="mousedown",e.DblClick="dblclick",e.Click="click",e.ContextMenu="contextmenu",e.KeyDown="keydown",e.Keyup="keyup",e.Keypress="keypress",e.Scroll="scroll",e.Resize="resize",e.Wheel="wheel",e.UndoRedoStateChanged="undoRedoStateChanged",e))(F||{});const We=12.5,Ge=.5,ft=4,oe=.25,U=.25,re=25,mt=.5,we=0,Ee=.01,Se=1,At=100,Xe=1,ht={scaleRatio:Xe,positionRange:{minX:0,maxX:0,minY:0,maxY:0}},pt={horizontal:40,vertical:80},vt={horizontal:0,vertical:0},Ct={width:2e3,height:2e3},V=!1,Rt="#000000",wt=1,H=[.47,.42,.9,.5],Et=100,St=20,It=3.5,ke="source-over",Ye="destination-in",bt="destination-out",Dt=2.5,_t=1,Lt=0,Bt=0,Tt=1,ze="rgba(119,106,230,1)",He="rgba(119,106,230,0)",Mt="rgba(255,255,255,1)",xt="rgba(255,255,255,0)",Ft=0,Ot=Math.PI*2,Pt=1,qe=-1,Nt=.04,Ie=.15,be=10;function Ut(e){return typeof e=="string"}function De(e){const{ctx:t,targetWidth:n,targetHeight:o,hiddenCtx:i,transformConfig:a,withBorder:s=!1}=e,{positionRange:c,scaleRatio:l}=a;t.canvas.width=n,t.canvas.height=o,t.imageSmoothingEnabled=V,K({ctx:t,hiddenCtx:i,positionRange:c,scaleRatio:l,withBorder:s,clearOld:!1})}function W(e={}){const{targetSize:t,cloneCanvas:n}=e,o=document.createElement("canvas"),i=o.getContext("2d");return t&&(o.width=t.width,o.height=t.height),n&&Vt.copyImageInCanvas(i,n),i}function yt(e,t){e.canvas.width=t.width,e.canvas.height=t.height,e.drawImage(t,0,0)}async function Ve(e){const t=new Image;return t.crossOrigin="anonymous",t.src=Ut(e)?e:URL.createObjectURL(e),await new Promise(n=>{t.onload=()=>n()}),createImageBitmap(t)}function Wt(e){Ke(e);const{hiddenCtx:t,imageSource:n,targetSize:{width:o,height:i}}=e;return Gt({ctx:t,imageSource:n,width:o,height:i})}function Ke(e){const{targetSize:t,hiddenCtx:n,drawingCtx:o}=e,{width:i,height:a}=t;n.canvas.width=i,n.canvas.height=a,o.canvas.width=i,o.canvas.height=a}function Gt(e){const{ctx:t,imageSource:n,width:o,height:i}=e;return t.drawImage(n,0,0,o,i),createImageBitmap(t.canvas)}function Xt(e){const{canvas:{width:t,height:n}}=e;e.clearRect(0,0,t,n)}function kt(e){const{ctx:t,lineStyle:n,lineWidth:o,positionRange:i}=e,{minY:a,maxX:s,maxY:c,minX:l}=i;t.imageSmoothingEnabled=!V,t.fillStyle=n,t.fillRect(l,a,s-l+o,o),t.fillRect(l,c,s-l+o,o),t.fillRect(l,a+o,o,c-a-o),t.fillRect(s,a+o,o,c-a-o),t.imageSmoothingEnabled=V}function Yt(e,t){const{width:n,height:o}=t.canvas;kt({ctx:e,positionRange:{minX:0,minY:0,maxX:n,maxY:o},lineStyle:Rt,lineWidth:wt})}function K(e){const{ctx:t,positionRange:n,scaleRatio:o,hiddenCtx:i}=e,{clearOld:a=!0,withBorder:s}=e,{minX:c,minY:l}=n;a&&Xt(t),t.save(),t.translate(c,l),t.scale(o,o),t.drawImage(i.canvas,0,0),s&&Yt(t,i),t.restore()}function ee(e){const{ctx:t,x:n,y:o,radius:i,hardness:a}=e,{innerColor:s=ze,outerColor:c=He}=e;t.beginPath();const l=t.createRadialGradient(n,o,Lt,n,o,i);l.addColorStop(Bt,s),l.addColorStop(a,s),l.addColorStop(Tt,c),t.fillStyle=l,t.arc(n,o,i,Ft,Ot),t.fill()}function _e(e,t){return zt(e,t).canvas.toDataURL()}function zt(e,t){const n=Ht(e);return qt(n,t,e),n}function Ht(e){const t=W({targetSize:e});return t.drawImage(e,0,0),t}function qt(e,t,n){e.globalCompositeOperation=Ye,e.drawImage(t.canvas,0,0,n.width,n.height)}const Vt={copyImageInCanvas:yt},{MouseDown:Kt,Mouseup:Zt,Mousemove:Qt}=F;class jt{constructor(){this.unbindDownUpCache=new WeakMap,this.unbindMoveCache=new WeakMap,this.unbindWheelCache=new Set}initMouseListeners(t){const{mouseTarget:n}=t;this.removeMouseListeners(n);const o=this.bindMouseListeners(t);this.unbindDownUpCache.set(n,o)}removeMouseListeners(t){const n=this.unbindDownUpCache.get(t);if(n){const{unbindDown:o,unbindUp:i}=n;o(),i()}}bindMouseListeners(t){const{mouseTarget:n,down:o,move:i,up:a}=t,s=r=>{requestAnimationFrame(()=>i(r))},c=r=>{const u=r.target===n,h=(o&&o(r))!==!1;if(u&&h){const m=this.listenEvent({eventType:Qt,listener:s,stop:!0,prevent:!0});this.unbindMoveCache.set(n,m)}},l=r=>{a&&a(r),this.unbindMoveListeners(n)},d=this.listenEvent({eventType:Kt,listener:c}),f=this.listenEvent({eventType:Zt,listener:l});return{unbindDown:d,unbindUp:f}}unbindMoveListeners(t){const n=this.unbindMoveCache.get(t);n&&n(),this.unbindMoveCache.delete(t)}initWheelListener(t){this.removeWheelListeners();const n=this.bindWheelListener(t);return this.unbindWheelCache.add(n),n}removeWheelListeners(){this.unbindWheelCache.forEach(t=>t()),this.unbindWheelCache.clear()}bindWheelListener(t){const{mattingBoards:n,wheel:o}=t;return this.listenEvent({eventType:F.Wheel,listener:i=>{this.canWheel(i,n)&&o(i)}},!1,...n)}canWheel(t,n){return n.some(o=>t.target===o)}listenEvent(t,n=!1,...o){const{eventType:i}=t,a=this.genWrapListener(t);let s;return this.isNeedToBindToTargets(o)?s=this.bindListeners(o,i,a,n):s=this.bindListener(window,i,a,n),s}genWrapListener(t){const{listener:n,stop:o,prevent:i}=t;return a=>{o&&a.stopPropagation(),i&&a.preventDefault(),n(a)}}isNeedToBindToTargets(t){return t.length!==0}bindListener(t,n,o,i){return t.addEventListener(n,o,i),()=>t.removeEventListener(n,o,i)}bindListeners(t,n,o,i){return t.forEach(a=>{a.addEventListener(n,o,i)}),()=>t.forEach(a=>{a.removeEventListener(n,o,i)})}}const{sign:Jt,abs:Le,max:$t}=Math;function en(e){const{x:t,y:n,minX:o,maxX:i,minY:a,maxY:s}=e;return t>=o&&t<=i&&n>=a&&n<=s}function tn(e){const{movementX:t,movementY:n}=e,o=Le(t),i=Le(n),a=$t(o,i);return{unsignedMovementX:o,unsignedMovementY:i,maxMovement:a}}function nn(e,t){return t>_t&&e>t/Dt}function on(e){const{drawingConfig:t,unsignedMovementX:n,unsignedMovementY:o,maxMovement:i}=e,{movementX:a,movementY:s,stepBase:c}=t,l=Be(a,c),d=Be(s,c),f=rn(n,i),r=Te(f,l,n,o),u=Te(!f,d,o,n);return{stepX:r,stepY:u}}function Be(e,t){return-Jt(e)*t}function rn(e,t){return e===t}function Te(e,t,n,o){return e?t:n/o*t}function an(e,t,n){return e-t>n}const{sqrt:sn,max:un}=Math;function G(e){return e|0}function cn(e,t){return sn(e**2+t**2)}function ln(e){return e/St}function dn(e,t){return un(mt,e)/t}function gn(e){return e/It}function fn(e,t){return{width:e.width*t,height:e.height*t}}function mn(e){for(const t of e){const{radius:n}=t,{maxMovement:o,unsignedMovementX:i,unsignedMovementY:a}=tn(t);nn(o,n)?An({drawingConfig:t,unsignedMovementX:i,unsignedMovementY:a,maxMovement:o}):vn(t),Cn(t)}}const y=W();function An(e){const{drawingConfig:t,maxMovement:n}=e,{step:o,stepBase:i,drawingCtx:a,radius:s,hardness:c}=t;let{x:l,y:d}=t;const{stepX:f,stepY:r}=on(e);pn(a);for(let u=0,A=u;u<n;u+=i,l+=f,d+=r)an(u,A,o)&&(A=u,ee({ctx:y,x:G(l),y:G(d),radius:s,hardness:c}));hn(t)}function hn(e){const{isErasing:t,hiddenCtx:n,drawingCtx:o}=e;t?n.value.drawImage(y.canvas,0,0):Ze(e,()=>{o.drawImage(y.canvas,0,0)})}function pn(e){const{width:t,height:n}=e.canvas;y.canvas.width=t,y.canvas.height=n,y.clearRect(0,0,t,n)}function vn(e){const{isErasing:t,hiddenCtx:n,drawingCtx:o}=e,{x:i,y:a,radius:s,hardness:c}=e;t?ee({ctx:n.value,x:i,y:a,radius:s,hardness:c}):Ze(e,()=>{ee({ctx:o,x:i,y:a,radius:s,hardness:c})})}async function Ze(e,t){const{hiddenCtx:n,drawingCtx:o,mattingSource:i}=e;o.globalCompositeOperation=ke,o.drawImage(i,0,0),o.globalCompositeOperation=Ye,t(),n.value.drawImage(o.canvas,0,0)}function Cn(e){const{ctx:t,hiddenCtx:n,positionRange:o,scaleRatio:i,isErasing:a}=e;K({ctx:t.value,hiddenCtx:n.value,positionRange:o,scaleRatio:i,withBorder:Rn(a)})}function Rn(e){return e!==void 0}function Qe(e){const t=e.getBoundingClientRect(),n=document.documentElement.getBoundingClientRect();return wn(t,n)}function wn(e,t){const{width:n,height:o,left:i,top:a}=e,{left:s,top:c}=t,l=i-s,d=a-c;return{left:l,top:d,width:n,height:o}}function ae(e){let{width:t,height:n}=e;const o=se({imageSize:{width:t,height:n},gapSize:vt,targetSize:Ct});return t*=o,n*=o,{width:t,height:n}}function se(e){const{imageSize:t,gapSize:n,targetSize:o}=e,i=ue(o,n);return Math.min(Math.min(i.width/t.width,i.height/t.height),Xe)}function ue(e,t){return{width:e.width-t.horizontal*2,height:e.height-t.vertical*2}}function je(e){const t=se(e),n=Je(e,t);return{scaleRatio:t,positionRange:n}}function Je(e,t){const n=fn(e.imageSize,t);return{minX:ce(e,n),maxX:$e(e,n),minY:le(e,n),maxY:et(e,n)}}function ce(e,t){const{gapSize:n,targetSize:o}=e;return G((ue(o,n).width-t.width)/2)+n.horizontal}function le(e,t){const{gapSize:n,targetSize:o}=e;return G((ue(o,n).height-t.height)/2)+n.vertical}function $e(e,t){return G(ce(e,t)+t.width)}function et(e,t){return G(le(e,t)+t.height)}const En={computeBoardRect:Qe,computeTransformParameters:je,computeScaleRatio:se,computeValidImageSize:ae,computePositionRange:Je,getPositionRangeMinX:ce,getPositionRangeMaxX:$e,getPositionRangeMinY:le,getPositionRangeMaxY:et},{sign:Sn}=Math;function tt(e,t){const{movementX:n,movementY:o}=e;t.minX+=n,t.maxX+=n,t.minY+=o,t.maxY+=o}function In(e,t){const{transformConfig:n,inputContexts:o,outputContexts:i}=t;nt(e,n)}function nt(e,t){const{deltaY:n,pageX:o,pageY:i,target:a}=e,{positionRange:s,scaleRatio:c}=t,{left:l,top:d}=En.computeBoardRect(a),f=B.computePivot(o,l),r=B.computePivot(i,d),u=B.computeDeltaRatio(n),A=B.computeNewScaleRatio(c,u);t.scaleRatio=B.computeClampedTargetScaleRatio(A);const h=Bn(t.scaleRatio,c);t.positionRange=B.computeNewPositionRange(s,{x:f,y:r},h)}function bn(e,t){return e-t}function Dn(e){return(B.isZoomOut(e)?qe:Pt)*Nt}function _n(e){return-Sn(e)===qe}function Ln(e,t){return e+e*t}function Bn(e,t){return(e-t)/t}function Tn(e){return e<Ie?Ie:e>be?be:e}function Mn(e,t,n){const{x:o,y:i}=t;let{minX:a,maxX:s,minY:c,maxY:l}=e;return a=B.computeNewSingleRange(a,o,n),s=B.computeNewSingleRange(s,o,n),c=B.computeNewSingleRange(c,i,n),l=B.computeNewSingleRange(l,i,n),{minX:a,maxX:s,minY:c,maxY:l}}function xn(e,t,n){const i=(e-t)*n;return e+i}const B={updateTransformConfigWhileScaling:nt,computePivot:bn,computeDeltaRatio:Dn,isZoomOut:_n,computeNewScaleRatio:Ln,computeClampedTargetScaleRatio:Tn,computeNewPositionRange:Mn,computeNewSingleRange:xn};function Fn(e){const{listenerManager:t,initDrawingConfig:n}=e,o=On(e);let i=!1;const{inputBoardDrawingConfig:{ctx:a,hiddenCtx:s},outputBoardDrawingConfig:{hiddenCtx:c},brushDrawingBaseConfig:{positionRange:l}}=o,{boardRect:d,draggingInputBoard:f}=o;Pn(o);const r=Un(o);let u=!1;document.removeEventListener("keydown",A,!1);function A(m){m.code==="Space"&&m.preventDefault(),i=m.code==="Space"}document.addEventListener("keydown",A,!1);function h(m){i=!1}document.removeEventListener("keydown",h,!1),document.addEventListener("keyup",h,!1),t.initMouseListeners({mouseTarget:a.value.canvas,down(m){if(!i)return u=kn({ev:m,boardRect:d,positionRange:l,draggingInputBoard:f}),u&&r(m),u},move(m){const{positionRange:v}=n.transformConfig;i&&tt(m,v),!f&&u&&r(m)},up(m){!f&&u&&(u=!1,r(m))}})}function On(e){const{imageSources:t,imageSources:{raw:n,mask:o},initDrawingConfig:i,boardContexts:a,...s}=e,{inputCtx:c,inputHiddenCtx:l,inputDrawingCtx:d,outputCtx:f,outputHiddenCtx:r,outputDrawingCtx:u}=a;return{brushDrawingBaseConfig:Nn(i),mattingSources:t,inputBoardDrawingConfig:{ctx:c,hiddenCtx:l,drawingCtx:d,mattingSource:o},outputBoardDrawingConfig:{ctx:f,hiddenCtx:r,drawingCtx:u,mattingSource:n},...s}}function Pn(e){const{inputBoardDrawingConfig:t,outputBoardDrawingConfig:n}=e,{mattingSources:{raw:o,mask:i},isErasing:a}=e;a?(t.mattingSource=o,n.hiddenCtx.value.globalCompositeOperation=bt):(t.mattingSource=i,n.hiddenCtx.value.globalCompositeOperation=ke)}function Nn(e){const{radius:t,hardness:n,transformConfig:{scaleRatio:o,positionRange:i}}=e,a=dn(t.value,o),s=ln(a),c=gn(a);return{radius:a,step:c,stepBase:s,scaleRatio:o,positionRange:i,hardness:n.value}}function Un(e){const{brushDrawingBaseConfig:t,brushDrawingBaseConfig:{step:n,scaleRatio:o,positionRange:i},boardRect:{left:a,top:s}}=e,{inputBoardDrawingConfig:c,outputBoardDrawingConfig:l,isErasing:d}=e;let f=0;return r=>{const u=Wn({ev:r,scaleRatio:o,positionRange:i,left:a,top:s}),{movementX:A,movementY:h}=u,m={...t,...u};f+=cn(A,h),yn(f,n,r.type)&&(f=0,mn([{...m,...c},{...m,...l,isErasing:d}]))}}function yn(e,t,n){return e>=t||n===F.MouseDown}function Wn(e){const{ev:t,scaleRatio:n,positionRange:o,left:i,top:a}=e,{minX:s,minY:c}=o,{movementX:l,movementY:d,pageX:f,pageY:r}=t,u=Gn({pageX:f,pageY:r,left:i,top:a,minX:s,minY:c,scaleRatio:n}),A=Xn({movementX:l,movementY:d},n);return{...u,...A}}function Gn(e){const{pageX:t,pageY:n,left:o,top:i,minX:a,minY:s,scaleRatio:c}=e,l=(t-o-a)/c,d=(n-i-s)/c;return{x:l,y:d}}function Xn(e,t){const{movementX:n,movementY:o}=e,i=n/t,a=o/t;return{movementX:i,movementY:a}}function kn(e){const{ev:t,boardRect:n,positionRange:o,draggingInputBoard:i}=e,{pageX:a,pageY:s}=t,{left:c,top:l}=n,{minX:d,maxX:f,minY:r,maxY:u}=o,A=B.computePivot(a,c),h=B.computePivot(s,l);return en({x:A,y:h,minX:d,maxX:f,minY:r,maxY:u})&&!i}function Yn(e){const{outputContexts:{ctx:t},transformConfig:n,listenerManager:o}=e;o.initMouseListeners({mouseTarget:t.canvas,move(i){const{positionRange:a}=n;tt(i,a)}})}function zn(e){const{inputContexts:{ctx:t},outputContexts:{ctx:n},listenerManager:o}=e;return o.initWheelListener({mattingBoards:[t.canvas,n.canvas],wheel(i){i.preventDefault(),In(i,e)}})}function Hn(e,t){const{radius:n,hardness:o,isErasing:i}=e,{boardContexts:a,transformConfig:s,mattingSources:c,draggingInputBoard:l,initialized:d,boardRect:f,listenerManager:r}=t,{inputCtx:u}=a;Oe(()=>{d.value&&Fn({listenerManager:r,imageSources:c.value,boardContexts:a,initDrawingConfig:{radius:n,hardness:o,transformConfig:s},isErasing:i.value,draggingInputBoard:l.value,boardRect:f.value})}),Pe(()=>{r.removeMouseListeners(u.value.canvas)})}function qn(e){const{boardContexts:t,initialized:n,draggingInputBoard:o,transformConfig:i,isDrawing:a,listenerManager:s}=e,{inputCtx:c,inputHiddenCtx:l,outputCtx:d,outputHiddenCtx:f}=t;q([n,o,a],()=>{if(n.value&&!a.value){const r={inputContexts:{ctx:c.value,hiddenCtx:l.value},outputContexts:{ctx:d.value,hiddenCtx:f.value},draggingInputBoard:o.value,listenerManager:s,transformConfig:i};Yn(r),zn(r),o.value||(i.positionRange={...i.positionRange})}},{deep:!0}),q([i],async()=>{if(n.value){const{positionRange:r,scaleRatio:u}=i,A={positionRange:r,scaleRatio:u};K({ctx:c.value,hiddenCtx:l.value,...A}),K({ctx:d.value,hiddenCtx:f.value,withBorder:!0,...A})}}),Pe(()=>{n.value&&(s.removeMouseListeners(d.value.canvas),s.removeWheelListeners())})}const Vn=function(){const e=function(r){window.console&&window.console.log&&window.console.log(r)},t={enable:{0:!0},disable:{0:!0},getParameter:{0:!0},drawArrays:{0:!0},drawElements:{0:!0,2:!0},createShader:{0:!0},getShaderParameter:{1:!0},getProgramParameter:{1:!0},getVertexAttrib:{1:!0},vertexAttribPointer:{2:!0},bindTexture:{0:!0},activeTexture:{0:!0},getTexParameter:{0:!0,1:!0},texParameterf:{0:!0,1:!0},texParameteri:{0:!0,1:!0,2:!0},texImage2D:{0:!0,2:!0,6:!0,7:!0},texSubImage2D:{0:!0,6:!0,7:!0},copyTexImage2D:{0:!0,2:!0},copyTexSubImage2D:{0:!0},generateMipmap:{0:!0},bindBuffer:{0:!0},bufferData:{0:!0,2:!0},bufferSubData:{0:!0},getBufferParameter:{0:!0,1:!0},pixelStorei:{0:!0,1:!0},readPixels:{4:!0,5:!0},bindRenderbuffer:{0:!0},bindFramebuffer:{0:!0},checkFramebufferStatus:{0:!0},framebufferRenderbuffer:{0:!0,1:!0,2:!0},framebufferTexture2D:{0:!0,1:!0,2:!0},getFramebufferAttachmentParameter:{0:!0,1:!0,2:!0},getRenderbufferParameter:{0:!0,1:!0},renderbufferStorage:{0:!0,1:!0},clear:{0:!0},depthFunc:{0:!0},blendFunc:{0:!0,1:!0},blendFuncSeparate:{0:!0,1:!0,2:!0,3:!0},blendEquation:{0:!0},blendEquationSeparate:{0:!0,1:!0},stencilFunc:{0:!0},stencilFuncSeparate:{0:!0,1:!0},stencilMaskSeparate:{0:!0},stencilOp:{0:!0,1:!0,2:!0},stencilOpSeparate:{0:!0,1:!0,2:!0,3:!0},cullFace:{0:!0},frontFace:{0:!0}};let n=null;function o(r){if(n==null){n={};for(const u in r)typeof r[u]=="number"&&(n[r[u]]=u)}}function i(){if(n==null)throw"WebGLDebugUtils.init(ctx) not called"}function a(r){return i(),!!n&&n[r]!==void 0}function s(r){i();const u=n&&n[r];return u!==void 0?u:"*UNKNOWN WebGL ENUM (0x"+r.toString(16)+")"}function c(r,u,A){const h=t[r];return h!==void 0&&h[u]?s(A):A.toString()}function l(r,u){o(r),u=u||function(v,C,S){let E="";for(let b=0;b<S.length;++b)E+=(b==0?"":", ")+c(C,b,S[b]);e("WebGL error "+s(v)+" in "+C+"("+E+")")};const A={};function h(v,C){return function(){const S=v[C].apply(v,arguments),E=v.getError();return E!=0&&(A[E]=!0,u(E,C,arguments)),S}}const m={};for(const v in r){const C=v;typeof r[C]=="function"?m[C]=h(r,C):m[C]=r[C]}return m.getError=function(){for(const v in A)if(A[v])return A[v]=!1,+v;return r.NO_ERROR},m}function d(r){const u=r.getParameter(r.MAX_VERTEX_ATTRIBS),A=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,A);for(let m=0;m<u;++m)r.disableVertexAttribArray(m),r.vertexAttribPointer(m,4,r.FLOAT,!1,0,0),r.vertexAttrib1f(m,0);r.deleteBuffer(A);const h=r.getParameter(r.MAX_TEXTURE_IMAGE_UNITS);for(let m=0;m<h;++m)r.activeTexture(r.TEXTURE0+m),r.bindTexture(r.TEXTURE_CUBE_MAP,null),r.bindTexture(r.TEXTURE_2D,null);for(r.activeTexture(r.TEXTURE0),r.useProgram(null),r.bindBuffer(r.ARRAY_BUFFER,null),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,null),r.bindFramebuffer(r.FRAMEBUFFER,null),r.bindRenderbuffer(r.RENDERBUFFER,null),r.disable(r.BLEND),r.disable(r.CULL_FACE),r.disable(r.DEPTH_TEST),r.disable(r.DITHER),r.disable(r.SCISSOR_TEST),r.blendColor(0,0,0,0),r.blendEquation(r.FUNC_ADD),r.blendFunc(r.ONE,r.ZERO),r.clearColor(0,0,0,0),r.clearDepth(1),r.clearStencil(-1),r.colorMask(!0,!0,!0,!0),r.cullFace(r.BACK),r.depthFunc(r.LESS),r.depthMask(!0),r.depthRange(0,1),r.frontFace(r.CCW),r.hint(r.GENERATE_MIPMAP_HINT,r.DONT_CARE),r.lineWidth(1),r.pixelStorei(r.PACK_ALIGNMENT,4),r.pixelStorei(r.UNPACK_ALIGNMENT,4),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!1),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),r.UNPACK_COLORSPACE_CONVERSION_WEBGL&&r.pixelStorei(r.UNPACK_COLORSPACE_CONVERSION_WEBGL,r.BROWSER_DEFAULT_WEBGL),r.polygonOffset(0,0),r.sampleCoverage(1,!1),r.scissor(0,0,r.canvas.width,r.canvas.height),r.stencilFunc(r.ALWAYS,0,4294967295),r.stencilMask(4294967295),r.stencilOp(r.KEEP,r.KEEP,r.KEEP),r.viewport(0,0,r.canvas.clientWidth,r.canvas.clientHeight),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT|r.STENCIL_BUFFER_BIT);r.getError(););}function f(r){const u={};let A=1,h=!1;const m=[];let v,C,S;const E={};function b(g){return g instanceof WebGLBuffer||g instanceof WebGLFramebuffer||g instanceof WebGLProgram||g instanceof WebGLRenderbuffer||g instanceof WebGLShader||g instanceof WebGLTexture}function D(g){for(let p=0;p<g.length;++p){const T=g[p];if(b(T))return T.__webglDebugContextLostId__==A}return!0}function M(){const g=Object.keys(E);for(let p=0;p<g.length;++p)delete E[g[p]]}function Z(g,p){const T=g[p];return function(){if(!h){if(!D(arguments)){E[g.INVALID_OPERATION]=!0;return}return T.apply(g,arguments)}}}for(const g in r){const p=g;typeof r[g]=="function"?u[p]=Z(r,p):u[p]=r[p]}function Q(g){return{statusMessage:g}}function te(){for(let g=0;g<m.length;++g){const p=m[g];p instanceof WebGLBuffer?r.deleteBuffer(p):p instanceof WebGLFramebuffer?r.deleteFramebuffer(p):p instanceof WebGLProgram?r.deleteProgram(p):p instanceof WebGLRenderbuffer?r.deleteRenderbuffer(p):p instanceof WebGLShader?r.deleteShader(p):p instanceof WebGLTexture&&r.deleteTexture(p)}}u.loseContext=function(){if(!h){for(h=!0,++A;r.getError(););M(),E[r.CONTEXT_LOST_WEBGL]=!0,setTimeout(function(){v&&v(Q("context lost"))},0)}},u.restoreContext=function(){if(h)if(C)setTimeout(function(){if(te(),d(r),h=!1,C){const g=C;C=S,S=void 0,g(Q("context restored"))}},0);else throw"You can not restore the context without a listener"},u.getError=function(){if(!h){let g;for(;g=r.getError();)E[g]=!0}for(const g in E)if(E[g])return delete E[g],+g;return r.NO_ERROR};const j=["createBuffer","createFramebuffer","createProgram","createRenderbuffer","createShader","createTexture"];for(let g=0;g<j.length;++g){const p=j[g];u[p]=function(T){return function(){if(h)return null;const P=T.apply(r,arguments);return P.__webglDebugContextLostId__=A,m.push(P),P}}(r[p])}const J=["getActiveAttrib","getActiveUniform","getBufferParameter","getContextAttributes","getAttachedShaders","getFramebufferAttachmentParameter","getParameter","getProgramParameter","getProgramInfoLog","getRenderbufferParameter","getShaderParameter","getShaderInfoLog","getShaderSource","getTexParameter","getUniform","getUniformLocation","getVertexAttrib"];for(let g=0;g<J.length;++g){const p=J[g];u[p]=function(T){return function(){return h?null:T.apply(r,arguments)}}(u[p])}const k=["isBuffer","isEnabled","isFramebuffer","isProgram","isRenderbuffer","isShader","isTexture"];for(let g=0;g<k.length;++g){const p=k[g];u[p]=function(T){return function(){return h?!1:T.apply(r,arguments)}}(u[p])}u.checkFramebufferStatus=function(g){return function(){return h?r.FRAMEBUFFER_UNSUPPORTED:g.apply(r,arguments)}}(u.checkFramebufferStatus),u.getAttribLocation=function(g){return function(){return h?-1:g.apply(r,arguments)}}(u.getAttribLocation),u.getVertexAttribOffset=function(g){return function(){return h?0:g.apply(r,arguments)}}(u.getVertexAttribOffset),u.isContextLost=function(){return h};function Y(g){return typeof g=="function"?g:function(p){g.handleEvent(p)}}return u.registerOnContextLostListener=function(g){v=Y(g)},u.registerOnContextRestoredListener=function(g){h?S=Y(g):C=Y(g)},u}return{init:o,mightBeEnum:a,glEnumToString:s,glFunctionArgToString:c,makeDebugContext:l,makeLostContextSimulatingContext:f,resetToInitialState:d}}(),Kn=function(){const e=function(a){return'<div style="margin: auto; width:500px;z-index:10000;margin-top:20em;text-align:center;">'+a+"</div>"},t='This page requires a browser that supports WebGL.<br/><a href="http://get.webgl.org">Click here to upgrade your browser.</a>',n=`It doesn't appear your computer can support WebGL.<br/><a href="http://get.webgl.org">Click here for more information.</a>`,o=function(a,s,c){function l(f){const r=document.getElementsByTagName("body")[0];if(r){let u=window.WebGLRenderingContext?n:t;f&&(u+="<br/><br/>Status: "+f),r.innerHTML=e(u)}}c=c||l,a.addEventListener&&a.addEventListener("webglcontextcreationerror",f=>{c=c||l,c(f.statusMessage)},!1);const d=i(a,s);return d||(window.WebGLRenderingContext,c("")),d},i=function(a,s){const c=["webgl","experimental-webgl","webkit-3d","moz-webgl"];let l=null;for(let d=0;d<c.length;++d){try{l=a.getContext(c[d],s)}catch{}if(l)break}return l};return{create3DContext:i,setupWebGL:o}}();window.requestAnimationFrame||(window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e,t){window.setTimeout(e,1e3/60)}}());window.cancelAnimationFrame||(window.cancelAnimationFrame=window.cancelRequestAnimationFrame||window.webkitCancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelAnimationFrame||window.mozCancelRequestAnimationFrame||window.msCancelAnimationFrame||window.msCancelRequestAnimationFrame||window.oCancelAnimationFrame||window.oCancelRequestAnimationFrame||window.clearTimeout);function Zn(e,t,n){const o=Qn(e,t,n);return o?(e.useProgram(o),e.program=o,!0):(console.error("Failed to create program"),!1)}function Qn(e,t,n){const o=Me(e,e.VERTEX_SHADER,t),i=Me(e,e.FRAGMENT_SHADER,n);if(!o||!i)return null;const a=e.createProgram();if(!a)return null;if(e.attachShader(a,o),e.attachShader(a,i),e.linkProgram(a),!e.getProgramParameter(a,e.LINK_STATUS)){const c=e.getProgramInfoLog(a);return console.error("Failed to link program: "+c),e.deleteProgram(a),e.deleteShader(i),e.deleteShader(o),null}return a}function Me(e,t,n){const o=e.createShader(t);if(o==null)return console.error("unable to create shader"),null;if(e.shaderSource(o,n),e.compileShader(o),!e.getShaderParameter(o,e.COMPILE_STATUS)){const a=e.getShaderInfoLog(o);return console.error("Failed to compile shader: "+a,n),e.deleteShader(o),null}return o}function jn(e,t){let n=Kn.setupWebGL(e);return n?((arguments.length<2||t)&&(n=Vn.makeDebugContext(n)),n):null}const Jn=`
attribute vec4 a_Position;
attribute vec2 a_TexCoord;
varying vec2 v_TexCoord;
void main() {
    gl_Position = a_Position;
    v_TexCoord = a_TexCoord;
}
`,$n=`
precision highp float;
uniform sampler2D u_Sampler;
uniform vec4 u_MaskColor;
varying vec2 v_TexCoord;
void main() {
    vec4 color = texture2D(u_Sampler, v_TexCoord);
		vec3 mixRGB = color.a > 0.0 ? mix(color.rgb, u_MaskColor.rgb, u_MaskColor.a) : color.rgb;
    gl_FragColor = vec4(mixRGB, color.a);
}
`;function eo(e,t=H){const n=jn(e);return n?Zn(n,Jn,$n)?no(n)?(to(n,"u_MaskColor",t),o=>{if(console.time("draw mask image"),!oo(n,o))return console.error("\u7EB9\u7406\u521D\u59CB\u5316\u5931\u8D25!");n.drawArrays(n.TRIANGLE_STRIP,0,4),console.timeEnd("draw mask image")}):console.error("\u7F13\u51B2\u533A\u521D\u59CB\u5316\u5931\u8D25!"):console.error("\u7740\u8272\u5668\u521D\u59CB\u5316\u5931\u8D25!"):console.error("\u83B7\u53D6WebGL\u7ED8\u5236\u4E0A\u4E0B\u6587\u5931\u8D25!")}function to(e,t,n){const o=e.getUniformLocation(e.program,t);if(!o)return console.error("\u83B7\u53D6attribute\u53D8\u91CF\u5B58\u50A8\u4F4D\u7F6E\u5931\u8D25!");Array.isArray(n)?e.uniform4fv(o,n):e.uniform1i(o,n)}function no(e){const t=e.getAttribLocation(e.program,"a_Position"),n=e.getAttribLocation(e.program,"a_TexCoord");if(!~t||!~n)return console.error("\u83B7\u53D6attribute\u53D8\u91CF\u5B58\u50A8\u4F4D\u7F6E\u5931\u8D25!"),!1;const o=e.createBuffer(),i=e.createBuffer();return!o||!i?(console.error("\u521B\u5EFA\u7F13\u51B2\u533A\u5BF9\u8C61\u5931\u8D25!"),!1):(xe(e,o,t,new Float32Array([-1,1,1,1,-1,-1,1,-1])),xe(e,i,n,new Float32Array([0,0,1,0,0,1,1,1])),!0)}function xe(e,t,n,o,i=2){e.bindBuffer(e.ARRAY_BUFFER,t),e.bufferData(e.ARRAY_BUFFER,o,e.STATIC_DRAW),e.vertexAttribPointer(n,i,e.FLOAT,!1,0,0),e.enableVertexAttribArray(n)}function oo(e,t){const n=e.createTexture();if(!n)return console.error("\u521B\u5EFA\u7EB9\u7406\u5BF9\u8C61\u5931\u8D25!"),!1;const o=e.getUniformLocation(e.program,"u_Sampler");return o?(e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,1),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,n),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),e.uniform1i(o,0),!0):(console.error("\u83B7\u53D6\u53D6\u6837\u5668\u53D8\u91CF\u5B58\u50A8\u4F4D\u7F6E\u5931\u8D25!"),!1)}async function ro(e){const{boardContexts:{inputCtx:t,outputCtx:n,inputHiddenCtx:o,inputDrawingCtx:i,outputHiddenCtx:a,outputDrawingCtx:s},picFile:c,transformConfig:l,targetSize:d,gapSize:f}=e;t.value.imageSmoothingEnabled=V,n.value.imageSmoothingEnabled=V;const r=await Ve(c),{scaleRatio:u,positionRange:A}=ao({imageSource:r,transformConfig:l,targetSize:d,gapSize:f}),h=ae(r);Wt({imageSource:r,targetSize:h,hiddenCtx:o.value,drawingCtx:i}),K({hiddenCtx:o.value,ctx:t.value,scaleRatio:u,positionRange:A}),Ke({targetSize:h,hiddenCtx:a.value,drawingCtx:s});const m=await createImageBitmap(o.value.canvas),v=await io({targetSize:h,imageSource:r});return{orig:r,raw:m,mask:v,positionRange:A,scaleRatio:u}}function io(e){const{targetSize:{width:t,height:n},imageSource:o}=e,i=document.createElement("canvas");i.width=t,i.height=n;const a=eo(i);return a&&a(o),createImageBitmap(i)}function ao(e){const{transformConfig:t,...n}=e;if(so(t)){const{scaleRatio:o,positionRange:i}=uo(n);t.scaleRatio=o,t.positionRange=i}return t}function so(e){const{scaleRatio:t,positionRange:n}=e;return!t||!n}function uo(e){const{imageSource:t,targetSize:n,gapSize:o=pt}=e,i=ae(t);return je({gapSize:o,imageSize:i,targetSize:n})}function co(e,t,n){var o=n||{},i=o.noTrailing,a=i===void 0?!1:i,s=o.noLeading,c=s===void 0?!1:s,l=o.debounceMode,d=l===void 0?void 0:l,f,r=!1,u=0;function A(){f&&clearTimeout(f)}function h(v){var C=v||{},S=C.upcomingOnly,E=S===void 0?!1:S;A(),r=!E}function m(){for(var v=arguments.length,C=new Array(v),S=0;S<v;S++)C[S]=arguments[S];var E=this,b=Date.now()-u;if(r)return;function D(){u=Date.now(),t.apply(E,C)}function M(){f=void 0}!c&&d&&!f&&D(),A(),d===void 0&&b>e?c?(u=Date.now(),a||(f=setTimeout(d?M:D,e))):D():a!==!0&&(f=setTimeout(d?M:D,d===void 0?e-b:e))}return m.cancel=h,m}function lo(e,t,n){var o=n||{},i=o.atBegin,a=i===void 0?!1:i;return co(e,t,{debounceMode:a!==!1})}function go(e,t){const{picFile:n}=e,{boardContexts:o,boardContexts:{inputCtx:i,outputCtx:a,inputHiddenCtx:s,outputHiddenCtx:c}}=t,{initMattingResult:l,width:d,height:f,initialized:r}=t,{boardRect:u,transformConfig:A,mattingSources:h}=t,m=()=>{u.value=Qe(i.value.canvas)},v=()=>{requestAnimationFrame(()=>{const C={targetHeight:f.value,targetWidth:d.value,transformConfig:A};De({ctx:i.value,hiddenCtx:s.value,...C}),De({ctx:a.value,hiddenCtx:c.value,withBorder:!0,...C})})};q([n],async()=>{if(n.value&&d.value&&f.value){r.value=!1,l.value=await ro({boardContexts:o,picFile:n.value,targetSize:{width:d.value,height:f.value},transformConfig:{},imageSources:{}});const{raw:C,mask:S,orig:E,positionRange:b,scaleRatio:D}=l.value;A.positionRange=b,A.scaleRatio=D,h.value={raw:C,mask:S,orig:E},m(),v(),r.value=!0}}),Ne(()=>{window.addEventListener(F.Resize,v),window.addEventListener("scroll",lo(Et,m))}),Ue(()=>{window.removeEventListener(F.Resize,v)})}function fo(){const e=w(null),t=w(!1),n=w(We),o=w(Ge),i=x(()=>n.value*ft),a=x(()=>`${Math.round(o.value*At)}%`);return{picFile:e,isErasing:t,radius:n,hardness:o,brushSize:i,hardnessText:a}}const Fe=W(),mo=W();function Ao(e){const t=w(0),n=w(0),o=w(null),i=w(null),a=w(null),s=w(!1),c=w(!1),l=ye(ht),d=w(null),f=w(null),r=w(!1),u=w(W()),A=w(W()),h=new jt,m={boardContexts:{inputCtx:o,outputCtx:i,inputDrawingCtx:Fe,outputDrawingCtx:mo,inputHiddenCtx:u,outputHiddenCtx:A},initMattingResult:a,transformConfig:l,mattingSources:d,initialized:r,boardRect:f},v={...m,draggingInputBoard:s,isDrawing:c,listenerManager:h};return go(e,{...m,width:t,height:n}),Hn(e,v),qn(v),{width:t,height:n,inputCtx:o,outputCtx:i,inputHiddenCtx:u,outputHiddenCtx:A,draggingInputBoard:s,transformConfig:l,initialized:r,mattingSources:d,inputDrawingCtx:Fe}}var ho="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAMAAACahl6sAAAAqFBMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAs30iGAAAAN3RSTlMAuWM77dq/k2lBMiPo0K6po0kdF8e0jXteCfvz49XLmYRZVBIDw552cm4p996If04rRjZQDu8uOlnnbwAABJZJREFUeNrt3Ily2jAQBuA15jJgDmMg3DeEq5zNvv+btZ1OJ1VbEtvS2qvOfm/giSOt/x8JhBBCCCGEEEIIIYQQQggh+Mt1sJED6+0d/MG5gN2qPv5UqIDNggn+cryBvdohvhu5YKvlGn9X88BODwdVX1tgo76DfxqewT6rDv5tsADr1PGf5mCZBj7xAlZp4lNWjSsb/EAZrDHFD+3AEiX8xBas0MVP9cACJ4zgC7A3w0hmwNwXjKgLrPUwshIw9or4XzzJDmPZAFNljKkJLOUwtgYw9IIJ1FfAzRwT6fSBlwUm5CyBk/sAkyq2gY/WAZNbB8DFdYg6wirw4OVRj8/jSdwa6hpzCOtvI9TAJ6yvHFEDn7D+UkANfML6/Rg18Anrqz5q4BPWByFq4BPWt9eogU9YvyyiBj5h/cNBDXzC+n4HNfAJ61d11MAorG+gBkZhfRMJvUJqNqiBUVg/RQ2MwvoSkmvB32x8DlwDvS6mIA8aNAopCx/kWZFj26vVwycs+2ff4lNWLb9KITXGBHg0pTslwNn7GBOXnrSshB4VqIYYGaduMadEHi4ABEUkMAVaL0rg4cEPbQcj4NWQKoXU4Qo/LTv4CW79qFpIneGXfh0/wK8dPSuF1ALerRr4BMdutDVUgo4IH4s8m1HvqxJzkH1mOQ8gpRY5ZbIPlOISSLkjJRgg+0RZt4GUWuT0yD5SJgGQeitEmkpnyLwPVYucEzzV492GVv3IU+mWcxcaTGJMpTtMbHQDUu0w1jRXxoRqLpBqF2NOczlMJO8BqaUTe5qbYwLDFpBSTxbVIZLFAeM6nIGUerLI6UM05yG3/rOuTEEPiOqa59V+NhJPQV6NU/fZ1JiC3COf5nOjNQVVClx6z6kyPVwgrsuYR1eofCcdKxBfdYIRbIFW18D0EITZN54nI9NDu5h1UD0zND0sHfzQCUiphdTgTPZblS7QUr/zFmS/VikBrVezu24zq8B9Z3rX3WQTuJfN77rTLAL3HMWuW0o/cH+h2XVPaQfuc6p6eJZu4L4g23V7qR5Eug+odqvXVI8htQ5Uu9VO4xCS7smiKdlKOKkCKS9PtVupK6G/B1JujWq3mquB+xuQuo2oVvnzIM3AvXKkWuVbwzQP7FwKVKu8l0/1uI5DtcqrFWr+CqTU5TEMqN7YYQuINYjqSLV6PNyBGr4b78GYqq8RuGv/RQpvYEgQpn5IJ0ex0i+LGRzRccwfM304WRzQ2Y9N71qrejbHc/a+4aK4kdXhnKpvtCpuZncjWDAxuAdPs7wPrD0xtguXsr1Dqx8aKr67moG7vtDIRDFjcBPY2sBM0WNxe1ZRu8bfJgzcuT3Jjs0dYEWtSa/M6AYwR531NIKfxgoylXzam6uBe+Z3ZnUSPsldDdwfkLlkk2vrwO/mr2aC2dX7yvHer2ns6dWt8bz1qxtzfq2MlMCdx01Z/5iYvsSKKv09MLLFzOTDLRiUwww5YNAd9fC54eWK2ZmASR7q4HS5gIsRcX8QcAcYEetX67tbDRPhdwlSpYBZAPPexpiyfHgCIYQQQgghhBBCCCGEEEIIE74BPoWbxHyLr50AAAAASUVORK5CYII=";class po{constructor(t,n){this.inputCtx=t,this.isErasing=n,this.cursorImage=w(""),this.inputCursorStyle=w(null),this.mattingCursorStyle=ye(Object.create(null)),this.radius=w(We),this.hardness=w(Ge),this.inputCanvas=x(()=>this.inputCtx.value.canvas),this.pointInnerColor=x(()=>this.isErasing.value?Mt:ze),this.pointOuterColor=x(()=>this.isErasing.value?xt:He),this.ctx=this.creatCursorCanvas()}creatCursorCanvas(){const t=document.createElement("canvas").getContext("2d");return this.updateCtx(t)}updateCtx(t){return t.canvas.width=this.radius.value*2,t.canvas.height=this.radius.value*2,t}async createCursorImage(){this.ctx=this.updateCtx(this.ctx);const t={ctx:this.ctx,x:this.radius.value,y:this.radius.value,radius:this.radius.value,hardness:this.hardness.value,innerColor:this.pointInnerColor.value,outerColor:this.pointOuterColor.value};return ee(t),await this.drawIcon(),await this.ctx.canvas.toDataURL()}async drawIcon(){if(this.isErasing.value){const t=await Ve(ho);this.ctx.drawImage(t,0,0,this.radius.value*2,this.radius.value*2)}}renderOutputCursor(){const t=this.inputCanvas.value;t.addEventListener(F.Mouseover,this.onShowCursor.bind(this)),t.addEventListener(F.Mousemove,this.onRenderOutputCursor.bind(this)),t.addEventListener(F.Mouseout,this.onHideCursor.bind(this))}onShowCursor(){this.mattingCursorStyle.display="initial"}onHideCursor(){this.mattingCursorStyle.display="none"}onRenderOutputCursor(t){this.mattingCursorStyle.left=t.offsetX-this.radius.value+"px",this.mattingCursorStyle.top=t.offsetY-this.radius.value+"px"}changeOutputCursorByDrag([t]){t?this.onHideCursor():this.onShowCursor()}updateCursorParams(t,n){this.hardness.value=t,this.radius.value=n}}function vo(e){const{inputCtx:t,isDragging:n,isErasing:o,hardness:i,radius:a}=e,s=new po(t,o),{cursorImage:c,mattingCursorStyle:l,renderOutputCursor:d}=s;return Oe(async()=>{s.updateCursorParams(i.value,a.value),c.value=await s.createCursorImage()}),q([n],s.changeOutputCursorByDrag.bind(s)),{mattingCursor:s,mattingCursorStyle:l,cursorImage:c,renderOutputCursor:d.bind(s)}}const Co=it({props:{hasHeader:{type:Boolean,default:!0}},emits:["register"],setup(e,{emit:t}){const n=w(null),o=w(null),i=w(""),a=w(null),s=w(!1),{picFile:c,isErasing:l,radius:d,hardness:f,brushSize:r,hardnessText:u}=fo(),{width:A,height:h,inputCtx:m,inputHiddenCtx:v,outputCtx:C,outputHiddenCtx:S,draggingInputBoard:E,initialized:b,mattingSources:D,transformConfig:M,inputDrawingCtx:Z}=Ao({picFile:c,isErasing:l,radius:d,hardness:f}),{cursorImage:Q,mattingCursorStyle:te,renderOutputCursor:j}=vo({inputCtx:m,isDragging:E,isErasing:l,radius:d,hardness:f}),J=x(()=>c.value?`matting_${c.value.name}`:"null"),k=x(()=>s.value||!b.value),Y=x(()=>({"save-btn":!0,disabled:k.value})),g=x(()=>s.value?"\u4FDD\u5B58\u4E2D...":"\u4FDD\u5B58"),p=_=>{const{files:L}=_.target;L&&L[0]&&/.+\.(jpg|jpeg|png|gif|webp)/.test(L[0].name)?c.value=L[0]:alert("\u672A\u9009\u62E9\u56FE\u7247\u6216\u56FE\u7247\u683C\u5F0F\u4E0D\u6B63\u786E(\u53EA\u652F\u6301jpg\u3001png\u3001gif\u3001webp), \u8BF7\u91CD\u65B0\u9009\u62E9")},T=(_,L)=>{Ae(()=>{fetch(_).then(I=>I.blob()).then(I=>{c.value=new File([I],`image_${Math.random()}.jpg`,{type:"image/jpeg"})}).catch(I=>{console.error("\u83B7\u53D6\u56FE\u7247\u5931\u8D25:",I)}),q(()=>b.value,async()=>{const I=await P(L);S.value.drawImage(I,0,0);let z=document.createElement("canvas");z.width=I.width,z.height=I.height;let fe=z.getContext("2d");fe.drawImage(I,0,0);let me=fe.getImageData(0,0,I.width,I.height),N=me.data;for(let O=0;O<N.length;O+=4)N[O+3]>0&&(N[O]=H[0]*255,N[O+1]=H[1]*255,N[O+2]=H[2]*255,N[O+3]=(H[3]-.15)*255);await Ae(),setTimeout(async()=>{M.scaleRatio+=1e-4,M.scaleRatio-=1e-4,setTimeout(()=>{Z.putImageData(me,0,0),v.value.drawImage(Z.canvas,0,0),console.log("ok"),setTimeout(()=>{M.scaleRatio+=1e-4,M.scaleRatio-=1e-4},100)},100)},100)})})};function P(_){return new Promise(L=>{let I=new Image;I.crossOrigin="anonymous",I.src=_,I.onload=function(){L(I)}})}function de(_){d.value=Number(d.value),_.code==="BracketLeft"?d.value>oe+U&&(d.value-=U):_.code==="BracketRight"&&d.value<re-U&&(d.value+=U)}function ot(){const _=n.value,L=o.value;m.value=_.getContext("2d"),C.value=L.getContext("2d");const{clientWidth:I,clientHeight:z}=_;A.value=I,h.value=z}function ge(){if(D.value&&!s.value){s.value=!0;const _=_e(D.value.orig,S.value);s.value=!1,i.value=_,setTimeout(()=>{var L;(L=a.value)==null||L.click()})}}function rt(){if(D.value&&!s.value)return _e(D.value.orig,S.value)}return Ne(()=>{t("register",{isErasing:l,onDownloadResult:ge,onFileChange:p,initLoadImages:T,radius:d,hardness:f,brushSize:r,hardnessText:u,constants:{RADIUS_SLIDER_MIN:oe,RADIUS_SLIDER_MAX:re,RADIUS_SLIDER_STEP:U,HARDNESS_SLIDER_MAX:Se,HARDNESS_SLIDER_STEP:Ee,HARDNESS_SLIDER_MIN:we},getResult:rt}),ot(),j(),document.addEventListener("keydown",de,!1)}),Ue(()=>{document.removeEventListener("keydown",de,!1)}),{onDownloadResult:ge,onFileChange:p,inputCvs:n,outputCvs:o,resultURL:i,resultLink:a,isErasing:l,radius:d,hardness:f,brushSize:r,hardnessText:u,saveBtnText:g,downloadFileName:J,saveBtnClass:Y,cursorImage:Q,mattingCursorStyle:te,cantSave:k,RADIUS_SLIDER_MIN:oe,RADIUS_SLIDER_MAX:re,RADIUS_SLIDER_STEP:U,HARDNESS_SLIDER_MAX:Se,HARDNESS_SLIDER_STEP:Ee,HARDNESS_SLIDER_MIN:we}}}),X=e=>(dt("data-v-66cab65d"),e=e(),gt(),e),Ro={key:0,class:"options-container"},wo={class:"default-wrap"},Eo={class:"option"},So=X(()=>R("label",{for:"image"},"\u9009\u62E9\u56FE\u7247\uFF1A",-1)),Io={class:"option"},bo=X(()=>R("span",null,"\u753B\u7B14\u7C7B\u578B\uFF1A",-1)),Do=X(()=>R("label",{for:"fix"},"\u4FEE\u8865",-1)),_o=X(()=>R("label",{for:"matting"},"\u64E6\u9664",-1)),Lo={class:"option"},Bo=X(()=>R("label",{for:"radius"},"\u753B\u7B14\u5C3A\u5BF8\uFF1A",-1)),To=["max","min","step"],Mo={class:"option"},xo=X(()=>R("label",{for:"hardness"},"\u753B\u7B14\u786C\u5EA6\uFF1A",-1)),Fo=["max","min","step"],Oo=["disabled"],Po={class:"board-container"},No={class:"matting-wrapper"},Uo={ref:"inputCvs",class:"matting-board"},yo=["src"],Wo={class:"matting-wrapper"},Go={ref:"outputCvs",class:"result-board"},Xo=["src"],ko=["href","download"];function Yo(e,t,n,o,i,a){return he(),pe(lt,null,[e.hasHeader?(he(),pe("div",Ro,[st(e.$slots,"default",{},()=>[R("div",wo,[R("div",Eo,[So,R("input",{id:"image",type:"file",accept:".jpg,.png,.gif,.webp",onChange:t[0]||(t[0]=(...s)=>e.onFileChange&&e.onFileChange(...s))},null,32)]),R("div",Io,[bo,Do,$(R("input",{id:"fix","onUpdate:modelValue":t[1]||(t[1]=s=>e.isErasing=s),type:"radio",value:!1},null,512),[[ve,e.isErasing]]),_o,$(R("input",{id:"matting","onUpdate:modelValue":t[2]||(t[2]=s=>e.isErasing=s),value:!0,type:"radio"},null,512),[[ve,e.isErasing]])]),R("div",Lo,[Bo,$(R("input",{id:"radius","onUpdate:modelValue":t[3]||(t[3]=s=>e.radius=s),class:"range-input",type:"range",max:e.RADIUS_SLIDER_MAX,min:e.RADIUS_SLIDER_MIN,step:e.RADIUS_SLIDER_STEP},null,8,To),[[Ce,e.radius]]),R("span",null,ne(e.brushSize),1)]),R("div",Mo,[xo,$(R("input",{id:"hardness","onUpdate:modelValue":t[4]||(t[4]=s=>e.hardness=s),class:"range-input",type:"range",max:e.HARDNESS_SLIDER_MAX,min:e.HARDNESS_SLIDER_MIN,step:e.HARDNESS_SLIDER_STEP},null,8,Fo),[[Ce,e.hardness]]),R("span",null,ne(e.hardnessText),1)]),R("button",{class:ut(e.saveBtnClass),disabled:e.cantSave,onClick:t[5]||(t[5]=(...s)=>e.onDownloadResult&&e.onDownloadResult(...s))},ne(e.saveBtnText),11,Oo)])],!0)])):ct("",!0),R("div",Po,[R("div",No,[R("canvas",Uo,null,512),R("img",{ref:"inputCursor",class:"matting-cursor",style:Re(e.mattingCursorStyle),src:e.cursorImage},null,12,yo)]),R("div",Wo,[R("canvas",Go,null,512),R("img",{class:"matting-cursor",style:Re(e.mattingCursorStyle),src:e.cursorImage},null,12,Xo)])]),R("a",{ref:"resultLink",href:e.resultURL,download:e.downloadFileName},null,8,ko)],64)}var ie=at(Co,[["render",Yo],["__scopeId","data-v-66cab65d"]]);ie.install=e=>{e.component(ie.name,ie)};export{ie as m};
